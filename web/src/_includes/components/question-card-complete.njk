{% macro questionCardComplete(params) %}
<!-- TITLE -->
<div class="meeting-item card rounded-top">
    {% if params.topic and params.showCategory !== "false" %}
    <div class="category">
        {# {{ params.topics[params.topic].icon or '' }}  #}
        {{ params.topic }}
    </div>
    {% endif %}
    <div class="padding flex column gap">
        <p class="bold">

           <span class="full {% if params.question.topics_summary_nl %}ai-hide-when-summary{% endif %}">
            {% for topic in params.question.topics_nl %}
                {{ topic }}<br>
            {% endfor %}
            </span>
            {% if params.question.topics_summary_nl %}
            <span class="summarized highlight ai-show-when-summary">{{ params.question.topics_summary_nl }}</span>
            {% endif %}

        </p>
        {% if params.hideAuthors !== "true"%}
        <div class="flex column">
            <!-- QUESTIONERS -->
            {% if (params.question.questioners | length) > 1 %}
            <p>Gesteld door</p>
            <p>
                <span class="questioners">
                    {% for questioner in params.question.questioners %}
                    {% set party = questioner.party | lower %}
                    {% set primaryColor = params.partyColors[party].primary or '#95a5a6' %}
                    {% set secondaryColor = params.partyColors[party].secondary or '#95a5a6' %}
                    <span class="party small" style="font-weight: bold; color: {{ primaryColor }}; background-color: {{ secondaryColor }};">{{ questioner.party }}</span>
                    <span class="questioner"><a href="/members/{{ questioner.name | slugify }}/">{{ questioner.name }}</a></span><br>
                    {% endfor %}
                </span>
            </p>
            {% else %}
            <p>Gesteld door</p>
            <p>
                {% set party = params.question.questioners[0].party | lower %}
                {% set primaryColor = params.partyColors[party].primary or '#95a5a6' %}
                {% set secondaryColor = params.partyColors[party].secondary or '#95a5a6' %}
                <span class="party small" style="font-weight: bold; color: {{ primaryColor }}; background-color: {{ secondaryColor }};">{{ params.question.questioners[0].party }}</span>
                <span class="questioner"><a href="/members/{{ params.question.questioners[0].name | slugify }}/">{{ params.question.questioners[0].name }}</a></span><br>
            </p>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

{% if params.nolink != true and params.nolink != 'true' %}
<a href="/sessions/{{ params.question.session_id }}/meetings/{{ params.question.type }}/{{ params.question.meeting_id }}/"
   class="card padding straight"
   style="border-top: none; display: flex; align-items: center; justify-content: space-between;">
    <div style="display: flex; flex-direction: column">
        <p>Gesteld aan</p>
        <p>
            {% for respondent in params.question.respondents %}
            {% set function = params.functions[respondent.name] | getActive(params.question.date) %}
            <span class="respondent">{{ respondent.name }}{% if function %} ({{ function.function }}){% endif %}</span>{% if not loop.last %}, {% endif %}
            {% endfor %}
        </p>
        <p>op {{ params.question.date | date }}</p>
    </div>
    {% lucide "chevron-right" %}
</a>
{% else %}
<div class="card padding straight" style="border-top: none;">
    <div style="display: flex; flex-direction: column">
        <p>Gesteld aan</p>
        <p>
            {% for respondent in params.question.respondents %}
            {% set function = params.functions[respondent.name] | getActive(params.question.date) %}
            <span class="respondent">{{ respondent.name }}{% if function %} ({{ function.function }}){% endif %}</span>{% if not loop.last %}, {% endif %}
            {% endfor %}
        </p>
        <p>op {{ params.question.date | date }}</p>
    </div>
</div>
{% endif %}

<!-- DISCUSSION TOGGLE -->
<div class="card padding straight" style="border-top: none;">
    <div style="display: flex; gap: 1rem;">
        <p>Bekijk antwoord</p>
        <button class="toggle-discussion">
            {% lucide "chevron-down" %}
        </button>
    </div>
</div>

<!-- DISCUSSION -->
{% set respondent_names = params.question.respondents | map('name') | list %}
<div class="discussion" style="display: flex; flex-direction: column; gap: 0.5rem;">
    {% if params.question.discussion_summary_nl %}
    <div class="message-container ai-discussion-summary ai-show-when-summary">
        <div class="speech ai-summary">
            <p style="font-weight: bold; margin: 0 0 0.25rem 0;">AI Samenvatting</p>
            <div class="ai-summary-html">{{ params.question.discussion_summary_nl }}</div>
        </div>
    </div>
    {% endif %}
    {% for x in params.question.discussion %}
    {% set speakerName = x.speaker.name if x.speaker and x.speaker.name else x.speaker %}
    <div class="message-container">
        <div class="speech
                {% if speakerName in respondent_names %}response
                {% elif speakerName == 'Voorzitter' %}moderator
                {% else %}question{% endif %}">

            {% if speakerName == 'Voorzitter' %}
            <p style="font-weight: bold; margin: 0;" class="capitalize-first">Voorzitter:</p>
            {% else %}
            <p style="font-weight: bold; margin: 0;">{{ speakerName }}:</p>
            {% endif %}

            {% set paragraphs = x.text.trim().split("NEWPARAGRAPH") %}
            <div>
                {% for part in paragraphs %}
                <p>{{ part.trim() }}</p>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% endmacro %}